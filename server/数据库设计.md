------

è¿™æ˜¯ä¸€ä»½é›†æˆäº†æ‚¨æ‰€æœ‰å˜æ›´éœ€æ±‚ï¼ˆ**è§„æ ¼å›ºå®š + ä¾›åº”å•†ä¸»å¯¼å½•å…¥ + å¤šæ–¹æŠ¥ä»· + å…¨é“¾è·¯æº¯æº + è´¢åŠ¡ç»“ç®— + ç³»ç»Ÿé…ç½®**ï¼‰çš„**æœ€ç»ˆå®Œæ•´ç‰ˆæ•°æ®åº“è®¾è®¡è¯´æ˜ä¹¦**ã€‚

æ­¤æ–‡æ¡£æŸ¥æ¼è¡¥ç¼ºï¼Œå·²åŒ…å«ç³»ç»Ÿè¿è¡Œæ‰€éœ€çš„å…¨éƒ¨æ•°æ®è¡¨ï¼Œå¯ç›´æ¥äº¤ä»˜åç«¯å¼€å‘å›¢é˜Ÿè¿›è¡Œ **V5.0** ç‰ˆæœ¬çš„å»ºè¡¨ä¸å¼€å‘ã€‚

------

# ğŸ“˜ æ ¡å›­é£Ÿæä¾›åº”é“¾å¹³å° - æ•°æ®åº“è®¾è®¡è¯´æ˜ä¹¦

ç‰ˆæœ¬: V5.0 (Final Production Edition)

çŠ¶æ€: å·²å®šç¨¿

æŠ€æœ¯æ ˆ: Go (Gorm) + MySQL 8.0

æœ€åæ›´æ–°: 2025-12-12

------

## 1. æ ¸å¿ƒè®¾è®¡ç†å¿µ (Core Concepts)

1. **SPU ä¸¥é€‰ä¸è§„æ ¼å›ºå®š (Standardized SPU)**:
   - **é€»è¾‘**: å•†å“çš„æ ‡å‡†å±æ€§ï¼ˆåç§°ã€å›¾ç‰‡ã€**è§„æ ¼**ï¼‰åœ¨ `scm_products` è¡¨ä¸­å®šä¹‰ã€‚ä¸€æ—¦å­¦æ ¡å®¡æ ¸é€šè¿‡ï¼Œè§„æ ¼å³é”å®šï¼ˆå¦‚â€œåœŸè±† 50æ–¤/è¢‹â€ï¼‰ã€‚
   - **ç›®çš„**: ç¡®ä¿ä¸åŒä¾›åº”å•†åœ¨è¿›è¡ŒæŠ¥ä»·æ—¶ï¼Œæ˜¯åœ¨åŒä¸€ä¸ªæ ‡å‡†ä¸‹ç«ä»·ï¼Œè§£å†³é£Ÿå ‚æ¯”ä»·éš¾çš„é—®é¢˜ã€‚
2. **ä¾›åº”å•†ä¸»å¯¼ä¸å¸‚åœºåŒ–ç«ä»· (Marketplace)**:
   - **å½•å…¥æƒ**: ä¾›åº”å•†æ‹¥æœ‰å‘èµ·æ–°å•†å“çš„æƒé™ï¼ˆå¡«åç§°ã€è§„æ ¼ã€å›¾ï¼‰ã€‚
   - **ç«ä»·æƒ**: å•†å“å…¥åº“åï¼Œå¤šä¸ªä¾›åº”å•†å¯å¯¹åŒä¸€å•†å“IDè¿›è¡ŒæŠ¥ä»·ã€‚æ•°æ®åº“é‡‡ç”¨ **SPU(1) : Quotes(N)** çš„å…³è”ç»“æ„ã€‚
3. **äº¤æ˜“å¿«ç…§ä¸å…¨é“¾è·¯æº¯æº (Snapshot & Trace)**:
   - **äº¤æ˜“å¿«ç…§**: ä¸‹å•ç¬é—´ï¼Œå›ºåŒ–å•†å“åã€è§„æ ¼ã€ä»·æ ¼è‡³è®¢å•æ˜ç»†ï¼Œé˜²æ­¢åç»­å•†å“æ”¹åå¯¼è‡´å†å²è®¢å•æ•°æ®å¤±çœŸã€‚
   - **æº¯æºå¿«ç…§**: è®¢å•å®Œæˆç¬é—´ï¼Œç”Ÿæˆå”¯ä¸€æº¯æºç ï¼Œå¹¶å°†å•†æˆ·ä¿¡æ¯ã€ä¾›åº”å•†èµ„è´¨ã€æ£€æµ‹æŠ¥å‘Šã€æ—¶é—´è½´å…¨éƒ¨â€œæ‰å¹³åŒ–â€å­˜å…¥æº¯æºè¡¨ã€‚
4. **è´¢åŠ¡ä¸è¿ç»´é—­ç¯**:
   - **è´¢åŠ¡**: å¢åŠ æµæ°´è¡¨ä¸æœˆåº¦å¯¹è´¦å•ï¼Œæ”¯æŒå‘¨æœŸç»“ç®—ã€‚
   - **è¿ç»´**: å¢åŠ æ•°æ®å­—å…¸ã€æ“ä½œæ—¥å¿—ã€Banneré…ç½®ï¼Œæ”¯æ’‘ç³»ç»Ÿé•¿æœŸç¨³å®šè¿è¡Œã€‚

------

## 2. å®ä½“å…³ç³»å›¾ (ER Diagram)

- **åŸºç¡€**: `Orgs` (ç»„ç»‡) -> `Users` (ç”¨æˆ·).
- **å•†å“**: `Category` -> `Product` (SPU) -> `Quotes` (SKU).
- **äº¤æ˜“**: `Cart` -> `Order` -> `Items` (å¿«ç…§) -> `AfterSales`.
- **æº¯æº**: `Items` -> `Traces` (æ‰å¹³åŒ–å¿«ç…§).
- **è´¢åŠ¡**: `Order` -> `Bills` (æµæ°´) -> `Statements` (å¯¹è´¦å•).

------

## 3. è¯¦ç»†è¡¨ç»“æ„è®¾è®¡ (Schema Detail)

### 3.1 ğŸ›ï¸ ç³»ç»ŸåŸºç¡€æ¨¡å— (System Base)

#### 1. `sys_organizations` (ç»„ç»‡æ¶æ„è¡¨)

**åŠŸèƒ½**: å¤šç§Ÿæˆ·æ ¸å¿ƒã€‚åŒ…å«åœ°ç†ä½ç½®ï¼ˆç”¨äºé…é€è·ç¦»è®¡ç®—ï¼‰ä¸è”ç³»äººã€‚

| **å­—æ®µå**      | **ç±»å‹** | **å¿…å¡«** | **æè¿°** | **å¤‡æ³¨**                                 |
| --------------- | -------- | -------- | -------- | ---------------------------------------- |
| `id`            | BIGINT   | YES      | ç»„ç»‡ID   | PK                                       |
| `name`          | VARCHAR  | YES      | ç»„ç»‡åç§° |                                          |
| `org_type`      | TINYINT  | YES      | **ç±»å‹** | **1:å¹³å° 2:å­¦æ ¡ 3:ä¾›åº”å•† 4:é£Ÿå ‚ 5:å•†æˆ·** |
| `parent_id`     | BIGINT   | YES      | çˆ¶çº§ID   | ä¾›åº”å•†/é£Ÿå ‚çš„çˆ¶çº§æ˜¯å­¦æ ¡ID                |
| `contact_name`  | VARCHAR  | YES      | è´Ÿè´£äºº   | ç”¨äºç´§æ€¥è”ç³»                             |
| `contact_phone` | VARCHAR  | YES      | ç”µè¯     | ç”¨äºæ¥æ”¶é€šçŸ¥çŸ­ä¿¡                         |
| `address`       | VARCHAR  | NO       | åœ°å€     |                                          |
| `longitude`     | DECIMAL  | NO       | **ç»åº¦** | ç”¨äºé…é€å®šä½/ç­¾åˆ°                        |
| `latitude`      | DECIMAL  | NO       | **çº¬åº¦** |                                          |
| `is_enabled`    | TINYINT  | YES      | çŠ¶æ€     | 1:å¯ç”¨ 0:ç¦ç”¨(å†»ç»“)                      |

#### 2. `sys_users` (ç”¨æˆ·/è´¦å·è¡¨)

**åŠŸèƒ½**: ç™»å½•å‡­è¯ä¸æƒé™ç»‘å®šã€‚

| **å­—æ®µå**  | **ç±»å‹** | **å¿…å¡«** | **æè¿°**     | **å¤‡æ³¨**                              |
| ----------- | -------- | -------- | ------------ | ------------------------------------- |
| `id`        | BIGINT   | YES      | ç”¨æˆ·ID       | PK                                    |
| `org_id`    | BIGINT   | YES      | **æ‰€å±ç»„ç»‡** | ç¡®å®šæ•°æ®æƒé™èŒƒå›´(SchoolID/SupplierID) |
| `username`  | VARCHAR  | YES      | è´¦å·         | UK                                    |
| `real_name` | VARCHAR  | YES      | **çœŸå®å§“å** | æ˜¾ç¤ºåœ¨æ“ä½œæ—¥å¿—ä¸­                      |
| `mobile`    | VARCHAR  | YES      | æ‰‹æœºå·       |                                       |
| `avatar`    | VARCHAR  | NO       | å¤´åƒ         |                                       |
| `role_id`   | BIGINT   | YES      | è§’è‰²ID       | å…³è”RBACæƒé™                          |
| `status`    | TINYINT  | YES      | çŠ¶æ€         | 1:æ­£å¸¸ 2:é”å®š                         |

#### 3. `sys_dictionaries` (æ•°æ®å­—å…¸è¡¨)

**åŠŸèƒ½**: ç»Ÿä¸€ç®¡ç†ä¸‹æ‹‰é€‰é¡¹ï¼ˆå¦‚å•ä½ï¼šæ–¤ã€è¢‹ã€ç®±ï¼‰ã€‚

| **å­—æ®µå**   | **ç±»å‹** | **å¿…å¡«** | **æè¿°** | **å¤‡æ³¨**       |
| ------------ | -------- | -------- | -------- | -------------- |
| `id`         | BIGINT   | YES      | ID       |                |
| `dict_code`  | VARCHAR  | YES      | ç¼–ç      | å¦‚ `unit_type` |
| `item_label` | VARCHAR  | YES      | å±•ç¤ºå   | å¦‚ `è¢‹`        |
| `item_value` | VARCHAR  | YES      | å­˜å‚¨å€¼   | å¦‚ `bag`       |

#### 4. `sys_op_logs` (æ“ä½œæ—¥å¿—è¡¨)

**åŠŸèƒ½**: å®‰å…¨å®¡è®¡ï¼Œè®°å½•è°åœ¨ä»€ä¹ˆæ—¶å€™å¹²äº†ä»€ä¹ˆã€‚

| **å­—æ®µå** | **ç±»å‹** | **å¿…å¡«** | **æè¿°** | **å¤‡æ³¨**      |
| ---------- | -------- | -------- | -------- | ------------- |
| `id`       | BIGINT   | YES      | ID       |               |
| `user_id`  | BIGINT   | YES      | æ“ä½œäºº   |               |
| `module`   | VARCHAR  | YES      | æ¨¡å—     | å¦‚ `å•†å“å®¡æ ¸` |
| `action`   | VARCHAR  | YES      | åŠ¨ä½œ     | å¦‚ `é©³å›`     |
| `params`   | JSON     | NO       | å‚æ•°     | è¯·æ±‚æ•°æ®å¿«ç…§  |

#### 5. `sys_banners` (è¿è¥å¹¿å‘Šè¡¨)

**åŠŸèƒ½**: å°ç¨‹åºé¦–é¡µè½®æ’­å›¾ã€‚

| **å­—æ®µå**  | **ç±»å‹** | **å¿…å¡«** | **æè¿°** | **å¤‡æ³¨**                |
| ----------- | -------- | -------- | -------- | ----------------------- |
| `id`        | BIGINT   | YES      | ID       |                         |
| `school_id` | BIGINT   | YES      | å®šå‘æŠ•æ”¾ | 0ä¸ºå…¨å¹³å°ï¼Œ>0ä¸ºç‰¹å®šå­¦æ ¡ |
| `image_url` | VARCHAR  | YES      | å›¾ç‰‡     |                         |
| `link_url`  | VARCHAR  | NO       | è·³è½¬é“¾   |                         |

------

### 3.2 ğŸ¥¦ å•†å“ä¾›åº”é“¾æ¨¡å— (Supply Chain)

#### 6. `scm_categories` (å•†å“åˆ†ç±»è¡¨)

**åŠŸèƒ½**: å•†å“å¯¼èˆªæ ‘ã€‚

| **å­—æ®µå**  | **ç±»å‹** | **å¿…å¡«** | **æè¿°** | **å¤‡æ³¨**       |
| ----------- | -------- | -------- | -------- | -------------- |
| `id`        | BIGINT   | YES      | ID       |                |
| `name`      | VARCHAR  | YES      | åˆ†ç±»å   | å¦‚ï¼šè”¬èœã€è‚‰ç±» |
| `parent_id` | BIGINT   | YES      | çˆ¶çº§ID   |                |
| `icon`      | VARCHAR  | NO       | å›¾æ ‡     |                |

#### 7. `scm_products` (å•†å“æ ‡å‡†åº“ SPU)

**åŠŸèƒ½**: å®šä¹‰â€œä¹°å–çš„æ ‡å‡†â€ã€‚æ‰€æœ‰ä¾›åº”å•†å¿…é¡»éµå®ˆæ­¤å¤„çš„è§„æ ¼ã€‚

| **å­—æ®µå**     | **ç±»å‹** | **å¿…å¡«** | **æè¿°**     | **å…³é”®é€»è¾‘**                           |
| -------------- | -------- | -------- | ------------ | -------------------------------------- |
| `id`           | BIGINT   | YES      | ID           |                                        |
| `school_id`    | BIGINT   | YES      | **ç›‘ç®¡å­¦æ ¡** | æ•°æ®éš”ç¦»æ ¹èŠ‚ç‚¹                         |
| `category_id`  | BIGINT   | YES      | åˆ†ç±»         |                                        |
| `name`         | VARCHAR  | YES      | **å•†å“åç§°** | å¦‚ï¼šä¸œåŒ—åœŸè±†                           |
| `image`        | VARCHAR  | YES      | **æ ‡å‡†å›¾**   | å®¡æ ¸é€šè¿‡åï¼Œå…¨å¹³å°å±•ç¤ºæ­¤å›¾             |
| `specs`        | VARCHAR  | YES      | **å›ºå®šè§„æ ¼** | **[æ ¸å¿ƒ]** å¦‚ï¼š50æ–¤/è¢‹ã€‚å®¡æ ¸åä¸å¯æ”¹ã€‚ |
| `unit`         | VARCHAR  | YES      | è®¡é‡å•ä½     | å¦‚ï¼šè¢‹                                 |
| `source_type`  | TINYINT  | YES      | **æ¥æº**     | 1:å¹³å°ä¸‹å‘ 2:å­¦æ ¡è‡ªå»º 3:ä¾›åº”å•†ä¸Šä¼      |
| `creator_id`   | BIGINT   | YES      | åˆ›å»ºè€…ID     | è®°å½•æœ€æ—©ä¸Šä¼ çš„ä¾›åº”å•†ID                 |
| `static_certs` | JSON     | NO       | **ä¸‰è¯èµ„è´¨** | å®¡æ ¸é€šè¿‡åï¼Œä¾›åº”å•†æ‰å¯ä¸Šä¼              |
| `audit_status` | TINYINT  | YES      | å®¡æ ¸çŠ¶æ€     | 0:å¾…å®¡ 1:é€šè¿‡ 2:é©³å›                   |
| `is_listed`    | TINYINT  | YES      | **ä¸Šæ¶çŠ¶æ€** | 1:ä¸Šæ¶(å…è®¸æŠ¥ä»·) 0:ä¸‹æ¶                |

#### 8. `scm_product_quotes` (ä¾›åº”å•†æŠ¥ä»· SKU)

**åŠŸèƒ½**: æ‰¿è½½â€œå¤šä¾›åº”å•†ç«ä»·â€ã€‚

| **å­—æ®µå**      | **ç±»å‹** | **å¿…å¡«** | **æè¿°**     | **å…³é”®é€»è¾‘**             |
| --------------- | -------- | -------- | ------------ | ------------------------ |
| `id`            | BIGINT   | YES      | ID           |                          |
| `product_id`    | BIGINT   | YES      | **å…³è”SPU**  | å¤–é”®æŒ‡å‘ `scm_products`  |
| `supplier_id`   | BIGINT   | YES      | **æŠ¥ä»·äºº**   | å…³è” `sys_organizations` |
| `price`         | DECIMAL  | YES      | **æŠ¥ä»·**     | é’ˆå¯¹å›ºå®šè§„æ ¼çš„ä»·æ ¼       |
| `batch_reports` | JSON     | NO       | **æ‰¹æ¬¡æŠ¥å‘Š** | è¯¥æ‰¹æ¬¡çš„å†œæ®‹æ£€æµ‹/æ£€ç–«ç¥¨  |
| `is_enabled`    | TINYINT  | YES      | ä¾›è´§å¼€å…³     | ä¾›åº”å•†å¯æš‚åœä¾›è´§         |

#### 9. `scm_supplier_staffs` (ä¾›åº”å•†å‘˜å·¥è¡¨)

**åŠŸèƒ½**: ç®¡ç†å¸æœºã€åˆ†æ‹£å‘˜ï¼Œç”¨äºæº¯æºå±•ç¤ºå’Œå®åç®¡æ§ã€‚

| **å­—æ®µå**    | **ç±»å‹** | **å¿…å¡«** | **æè¿°**   | **å¤‡æ³¨**      |
| ------------- | -------- | -------- | ---------- | ------------- |
| `id`          | BIGINT   | YES      | ID         |               |
| `supplier_id` | BIGINT   | YES      | æ‰€å±ä¾›åº”å•† |               |
| `name`        | VARCHAR  | YES      | å§“å       |               |
| `role_type`   | TINYINT  | YES      | èŒä½       | 1:å¸æœº 2:åˆ†æ‹£ |
| `health_cert` | VARCHAR  | NO       | å¥åº·è¯å›¾   |               |

------

### 3.3 ğŸ›ï¸ è®¢å•äº¤æ˜“æ¨¡å— (Order Center)

#### 10. `ord_carts` (è´­ç‰©è½¦)

**åŠŸèƒ½**: ä¸‹å•å‰æš‚å­˜ã€‚**æ ¸å¿ƒæ˜¯å­˜ quote_id**ï¼ˆé€‰ä¸­çš„æ˜¯å“ªä¸ªä¾›åº”å•†çš„æŠ¥ä»·ï¼‰ã€‚

| **å­—æ®µå**    | **ç±»å‹** | **å¿…å¡«** | **æè¿°**     | **å¤‡æ³¨**               |
| ------------- | -------- | -------- | ------------ | ---------------------- |
| `id`          | BIGINT   | YES      | ID           |                        |
| `merchant_id` | BIGINT   | YES      | ä¹°å®¶         |                        |
| `quote_id`    | BIGINT   | YES      | **é€‰ä¸­æŠ¥ä»·** | è´­ç‰©è½¦é’ˆå¯¹å…·ä½“ä»·æ ¼åŠ è´­ |
| `quantity`    | INT      | YES      | æ•°é‡         |                        |

#### 11. `ord_orders` (è®¢å•ä¸»è¡¨)

**åŠŸèƒ½**: äº¤æ˜“å•æ®æ ¸å¿ƒã€‚

| **å­—æ®µå**         | **ç±»å‹** | **å¿…å¡«** | **æè¿°**     | **å…³é”®é€»è¾‘**                |
| ------------------ | -------- | -------- | ------------ | --------------------------- |
| `id`               | BIGINT   | YES      | ID           |                             |
| `order_no`         | VARCHAR  | YES      | è®¢å•å·       | UK                          |
| `merchant_id`      | BIGINT   | YES      | ä¹°å®¶         | å•†æˆ·ID                      |
| `supplier_id`      | BIGINT   | YES      | å–å®¶         | ä¾›åº”å•†ID                    |
| `status`           | TINYINT  | YES      | çŠ¶æ€         | 10:å¾…æ¥ 30:é…é€ 40:å®Œæˆ     |
| `receipt_vouchers` | JSON     | NO       | **æ”¶è´§å‡­è¯** | **[æ ¸å¿ƒ]** æ”¶è´§ç°åœºç…§ç‰‡æ•°ç»„ |
| `total_amount`     | DECIMAL  | YES      | æ€»é‡‘é¢       |                             |
| `created_at`       | DATETIME | YES      | ä¸‹å•æ—¶é—´     |                             |
| `delivery_time`    | DATETIME | NO       | é…é€æ—¶é—´     |                             |
| `arrival_time`     | DATETIME | NO       | é€è¾¾æ—¶é—´     |                             |

#### 12. `ord_order_items` (è®¢å•æ˜ç»† - äº¤æ˜“å¿«ç…§)

**åŠŸèƒ½**: å³ä½¿å•†å“åº“åˆ äº†ï¼Œè¿™é‡Œçš„â€œä¹°å–å¥‘çº¦â€æ°¸è¿œä¸å˜ã€‚

| **å­—æ®µå**   | **ç±»å‹** | **å¿…å¡«** | **æè¿°**      | **å…³é”®é€»è¾‘**           |
| ------------ | -------- | -------- | ------------- | ---------------------- |
| `id`         | BIGINT   | YES      | ID            |                        |
| `order_id`   | BIGINT   | YES      | è®¢å•ID        |                        |
| `product_id` | BIGINT   | YES      | å•†å“ID        | çŸ¥é“ä¹°äº†å“ªä¸ªSPU        |
| `quote_id`   | BIGINT   | YES      | æŠ¥ä»·ID        | çŸ¥é“é€‰äº†è°çš„ä»·         |
| `snap_name`  | VARCHAR  | YES      | **å¿«ç…§:å“å** | ä¸‹å•æ—¶çš„åç§°           |
| `snap_specs` | VARCHAR  | YES      | **å¿«ç…§:è§„æ ¼** | ä¸‹å•æ—¶çš„è§„æ ¼ (50æ–¤/è¢‹) |
| `snap_price` | DECIMAL  | YES      | **å¿«ç…§:å•ä»·** | ä¸‹å•æ—¶çš„ä»·æ ¼           |
| `quantity`   | INT      | YES      | æ•°é‡          |                        |

#### 13. `ord_after_sales` (å”®åè¡¨)

**åŠŸèƒ½**: å¤„ç†é€€æ¬¾/è¡¥è´§æµç¨‹ã€‚

| **å­—æ®µå**      | **ç±»å‹** | **å¿…å¡«** | **æè¿°** | **å¤‡æ³¨**                |
| --------------- | -------- | -------- | -------- | ----------------------- |
| `id`            | BIGINT   | YES      | ID       |                         |
| `order_item_id` | BIGINT   | YES      | å…³è”æ˜ç»† | é’ˆå¯¹å…·ä½“å•†å“é€€æ¬¾        |
| `type`          | TINYINT  | YES      | ç±»å‹     | 1:ä»…é€€æ¬¾ 2:é€€è´§é€€æ¬¾     |
| `reason`        | VARCHAR  | YES      | åŸå›      |                         |
| `apply_amount`  | DECIMAL  | YES      | é‡‘é¢     |                         |
| `status`        | TINYINT  | YES      | çŠ¶æ€     | 10:å¾…å®¡ 20:é€šè¿‡ 30:é©³å› |

------

### 3.4 ğŸ” æº¯æºä½“ç³» (Traceability)

#### 14. `ord_item_traces` (å…¨é“¾è·¯æº¯æºè¡¨)

**åŠŸèƒ½**: æ‰å¹³åŒ–å­˜å‚¨ï¼Œæ‰«ç å³è¯»ï¼Œæ— éœ€è”è¡¨æŸ¥è¯¢ã€‚

| **å­—æ®µå**      | **ç±»å‹** | **å¿…å¡«** | **æè¿°**       | **å…³é”®é€»è¾‘**                        |
| --------------- | -------- | -------- | -------------- | ----------------------------------- |
| `id`            | BIGINT   | YES      | ID             |                                     |
| `order_item_id` | BIGINT   | YES      | æ˜ç»†ID         | 1å¯¹1å…³è”                            |
| `trace_code`    | VARCHAR  | YES      | **æº¯æºç **     | å”¯ä¸€äºŒç»´ç                           |
| `merchant_info` | JSON     | YES      | **å•†æˆ·å¿«ç…§**   | `{name, canteen, school}`           |
| `supplier_info` | JSON     | YES      | **ä¾›åº”å•†å¿«ç…§** | `{name, license, contact}`          |
| `cert_snapshot` | JSON     | YES      | **è¯ä¹¦å¿«ç…§**   | `{static_certs, batch_reports}`     |
| `time_line`     | JSON     | YES      | **æ—¶é—´è½´**     | `{order_at, deliver_at, arrive_at}` |
| `driver_id`     | BIGINT   | NO       | **å¸æœº**       | å…³è” `scm_supplier_staffs`          |
| `qc_cert_image` | VARCHAR  | NO       | å®ç‰©æ£€æµ‹å›¾     | ç°åœºå®æ‹çš„æ£€æµ‹å›¾                    |

------

### 3.5 ğŸ’° è´¢åŠ¡ç»“ç®—æ¨¡å— (Finance)

#### 15. `fin_bills` (èµ„é‡‘æµæ°´è¡¨)

**åŠŸèƒ½**: è®°å½•æ¯ä¸€ç¬”é’±çš„è¿›å‡ºã€‚

| **å­—æ®µå**     | **ç±»å‹** | **å¿…å¡«** | **æè¿°** | **å¤‡æ³¨**              |
| -------------- | -------- | -------- | -------- | --------------------- |
| `id`           | BIGINT   | YES      | ID       |                       |
| `bill_no`      | VARCHAR  | YES      | æµæ°´å·   |                       |
| `order_id`     | BIGINT   | YES      | å…³è”è®¢å• |                       |
| `amount`       | DECIMAL  | YES      | é‡‘é¢     |                       |
| `bill_type`    | TINYINT  | YES      | ç±»å‹     | 1:è®¢å•æ”¶æ¬¾ 2:å”®åé€€æ¬¾ |
| `io_direction` | TINYINT  | YES      | æ–¹å‘     | 1:æ”¶å…¥ 2:æ”¯å‡º         |

#### 16. `fin_statements` (æœˆåº¦å¯¹è´¦å•)

**åŠŸèƒ½**: æ±‡æ€»æµæ°´ï¼Œä¾›çº¿ä¸‹ç»“ç®—ä½¿ç”¨ã€‚

| **å­—æ®µå**      | **ç±»å‹** | **å¿…å¡«** | **æè¿°** | **å¤‡æ³¨**                  |
| --------------- | -------- | -------- | -------- | ------------------------- |
| `id`            | BIGINT   | YES      | ID       |                           |
| `period`        | VARCHAR  | YES      | è´¦æœŸ     | å¦‚ `2025-12`              |
| `supplier_id`   | BIGINT   | YES      | ä¾›åº”å•†   |                           |
| `school_id`     | BIGINT   | YES      | å­¦æ ¡     |                           |
| `settle_amount` | DECIMAL  | YES      | åº”ç»“é‡‘é¢ | (é”€å”® - é€€æ¬¾)             |
| `status`        | TINYINT  | YES      | çŠ¶æ€     | 10:å¾…æ ¸ 20:å·²æ ¸ 30:å·²æ‰“æ¬¾ |

------

## 4. SQL åˆå§‹åŒ–è„šæœ¬ (V5.0 Complete)

SQL



```
CREATE DATABASE IF NOT EXISTS `school_scm` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE `school_scm`;

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- 1. ç»„ç»‡
DROP TABLE IF EXISTS `sys_organizations`;
CREATE TABLE `sys_organizations` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` varchar(100) NOT NULL,
  `org_type` tinyint NOT NULL COMMENT '1:å¹³å° 2:å­¦æ ¡ 3:ä¾›åº”å•† 4:é£Ÿå ‚ 5:å•†æˆ·',
  `parent_id` bigint UNSIGNED NOT NULL DEFAULT '0',
  `contact_name` varchar(50) DEFAULT NULL,
  `contact_phone` varchar(20) DEFAULT NULL,
  `address` varchar(255) DEFAULT NULL,
  `longitude` decimal(10,6) DEFAULT NULL,
  `latitude` decimal(10,6) DEFAULT NULL,
  `is_enabled` tinyint(1) NOT NULL DEFAULT '1',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;

-- 2. ç”¨æˆ·
DROP TABLE IF EXISTS `sys_users`;
CREATE TABLE `sys_users` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `org_id` bigint UNSIGNED NOT NULL,
  `username` varchar(50) NOT NULL,
  `password` varchar(100) NOT NULL,
  `real_name` varchar(50) NOT NULL,
  `mobile` varchar(20) DEFAULT NULL,
  `avatar` varchar(255) DEFAULT NULL,
  `role_id` bigint UNSIGNED NOT NULL DEFAULT '0',
  `status` tinyint NOT NULL DEFAULT '1',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_username` (`username`)
) ENGINE=InnoDB;

-- 3. å­—å…¸
DROP TABLE IF EXISTS `sys_dictionaries`;
CREATE TABLE `sys_dictionaries` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `dict_code` varchar(50) NOT NULL,
  `item_label` varchar(50) NOT NULL,
  `item_value` varchar(50) NOT NULL,
  `sort` int NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;

-- 4. æ—¥å¿—
DROP TABLE IF EXISTS `sys_op_logs`;
CREATE TABLE `sys_op_logs` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `user_id` bigint UNSIGNED NOT NULL,
  `module` varchar(50) NOT NULL,
  `action` varchar(50) NOT NULL,
  `params` json DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;

-- 5. Banner
DROP TABLE IF EXISTS `sys_banners`;
CREATE TABLE `sys_banners` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `school_id` bigint UNSIGNED NOT NULL DEFAULT '0',
  `image_url` varchar(255) NOT NULL,
  `link_url` varchar(255) DEFAULT NULL,
  `is_enabled` tinyint(1) NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;

-- 6. åˆ†ç±»
DROP TABLE IF EXISTS `scm_categories`;
CREATE TABLE `scm_categories` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `parent_id` bigint UNSIGNED NOT NULL DEFAULT '0',
  `icon` varchar(255) DEFAULT NULL,
  `sort` int NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;

-- 7. äº§å“ (SPU)
DROP TABLE IF EXISTS `scm_products`;
CREATE TABLE `scm_products` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `school_id` bigint UNSIGNED NOT NULL,
  `category_id` bigint UNSIGNED NOT NULL,
  `name` varchar(100) NOT NULL,
  `image` varchar(255) DEFAULT NULL,
  `specs` varchar(100) NOT NULL COMMENT 'å›ºå®šè§„æ ¼',
  `unit` varchar(20) NOT NULL,
  `source_type` tinyint NOT NULL DEFAULT '3',
  `creator_id` bigint UNSIGNED DEFAULT '0',
  `static_certs` json DEFAULT NULL,
  `audit_status` tinyint NOT NULL DEFAULT '0',
  `is_listed` tinyint(1) NOT NULL DEFAULT '0',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_school` (`school_id`)
) ENGINE=InnoDB;

-- 8. æŠ¥ä»· (SKU)
DROP TABLE IF EXISTS `scm_product_quotes`;
CREATE TABLE `scm_product_quotes` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `product_id` bigint UNSIGNED NOT NULL,
  `supplier_id` bigint UNSIGNED NOT NULL,
  `price` decimal(10,2) NOT NULL,
  `batch_reports` json DEFAULT NULL,
  `is_enabled` tinyint(1) NOT NULL DEFAULT '1',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_prod_sup` (`product_id`, `supplier_id`)
) ENGINE=InnoDB;

-- 9. å‘˜å·¥
DROP TABLE IF EXISTS `scm_supplier_staffs`;
CREATE TABLE `scm_supplier_staffs` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `supplier_id` bigint UNSIGNED NOT NULL,
  `name` varchar(50) NOT NULL,
  `mobile` varchar(20) NOT NULL,
  `role_type` tinyint NOT NULL,
  `health_cert` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;

-- 10. è´­ç‰©è½¦
DROP TABLE IF EXISTS `ord_carts`;
CREATE TABLE `ord_carts` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `merchant_id` bigint UNSIGNED NOT NULL,
  `quote_id` bigint UNSIGNED NOT NULL,
  `quantity` int NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;

-- 11. è®¢å•
DROP TABLE IF EXISTS `ord_orders`;
CREATE TABLE `ord_orders` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `order_no` varchar(32) NOT NULL,
  `merchant_id` bigint UNSIGNED NOT NULL,
  `supplier_id` bigint UNSIGNED NOT NULL,
  `status` tinyint NOT NULL DEFAULT '10',
  `receipt_vouchers` json DEFAULT NULL,
  `total_amount` decimal(12,2) NOT NULL DEFAULT '0.00',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `delivery_time` datetime DEFAULT NULL,
  `arrival_time` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_order_no` (`order_no`)
) ENGINE=InnoDB;

-- 12. æ˜ç»†
DROP TABLE IF EXISTS `ord_order_items`;
CREATE TABLE `ord_order_items` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `order_id` bigint UNSIGNED NOT NULL,
  `product_id` bigint UNSIGNED NOT NULL,
  `quote_id` bigint UNSIGNED NOT NULL,
  `snap_name` varchar(100) NOT NULL,
  `snap_specs` varchar(100) NOT NULL,
  `snap_price` decimal(10,2) NOT NULL,
  `quantity` int NOT NULL,
  `amount` decimal(12,2) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `idx_order` (`order_id`)
) ENGINE=InnoDB;

-- 13. å”®å
DROP TABLE IF EXISTS `ord_after_sales`;
CREATE TABLE `ord_after_sales` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `order_item_id` bigint UNSIGNED NOT NULL,
  `type` tinyint NOT NULL,
  `reason` varchar(255) NOT NULL,
  `apply_amount` decimal(10,2) NOT NULL,
  `status` tinyint NOT NULL DEFAULT '10',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;

-- 14. æº¯æº
DROP TABLE IF EXISTS `ord_item_traces`;
CREATE TABLE `ord_item_traces` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `order_item_id` bigint UNSIGNED NOT NULL,
  `trace_code` varchar(64) NOT NULL,
  `merchant_info` json DEFAULT NULL,
  `supplier_info` json DEFAULT NULL,
  `cert_snapshot` json DEFAULT NULL,
  `time_line` json DEFAULT NULL,
  `driver_id` bigint UNSIGNED DEFAULT '0',
  `qc_cert_image` varchar(255) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_code` (`trace_code`)
) ENGINE=InnoDB;

-- 15. æµæ°´
DROP TABLE IF EXISTS `fin_bills`;
CREATE TABLE `fin_bills` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `bill_no` varchar(32) NOT NULL,
  `order_id` bigint UNSIGNED NOT NULL,
  `school_id` bigint UNSIGNED NOT NULL,
  `supplier_id` bigint UNSIGNED NOT NULL,
  `amount` decimal(12,2) NOT NULL,
  `bill_type` tinyint NOT NULL,
  `io_direction` tinyint NOT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;

-- 16. å¯¹è´¦å•
DROP TABLE IF EXISTS `fin_statements`;
CREATE TABLE `fin_statements` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `period` varchar(7) NOT NULL,
  `supplier_id` bigint UNSIGNED NOT NULL,
  `school_id` bigint UNSIGNED NOT NULL,
  `settle_amount` decimal(12,2) NOT NULL,
  `status` tinyint NOT NULL DEFAULT '10',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;

SET FOREIGN_KEY_CHECKS = 1;
```